<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tube-Programme - Curateurs de Savoir</title>
    
    <!-- Tailwind CSS pour le style -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & Babel pour le rendu et le JSX -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #020617; color: #e2e8f0; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .glass { background: rgba(15, 23, 42, 0.6); backdrop-filter: blur(12px); }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        /**
         * ⚠️ ATTENTION : CONFIGURATION REQUISE
         * Remplacez les valeurs ci-dessous par celles fournies par Firebase Console.
         * Sans cela, l'application affichera une erreur d'API Key.
         */
        const firebaseConfig = {
            apiKey: "AIzaSyCKamP75x_siY9MAmzQJEOiDR3JBk9n6-4",
            authDomain: "verbonautes.firebaseapp.com",
            projectId: "verbonautes",
            storageBucket: "verbonautes.firebasestorage.app",
            messagingSenderId: "578222598670",
            appId: "1:578222598670:web:4535fbec0ed7cdb26c6a5f"
        };

        // Imports Firebase via CDN
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, doc, setDoc, onSnapshot, updateDoc, increment, deleteDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Initialisation sécurisée (vérifie si les clés sont valides)
        const isConfigured = firebaseConfig.apiKey !== "VOTRE_API_KEY";
        let db, auth;
        
        if (isConfigured) {
            const app = initializeApp(firebaseConfig);
            auth = getAuth(app);
            db = getFirestore(app);
        }

        const appId = "tube-prog-v0";
        const THEMES = [
            { id: 'ia', label: 'IA', icon: 'cpu' },
            { id: 'lecture', label: 'Lecture', icon: 'book-open' },
            { id: 'foot', label: 'Football', icon: 'trophy' },
            { id: 'interviews', label: 'Interviews', icon: 'mic-2' },
        ];

        // --- COMPOSANTS ---

        const ProgramCard = ({ program, onSelect, isAdmin, onDelete }) => (
            <div 
                onClick={() => onSelect(program)}
                className="flex-shrink-0 w-80 bg-slate-900/40 backdrop-blur-sm rounded-2xl overflow-hidden cursor-pointer border border-slate-800/50 hover:border-indigo-500/50 hover:bg-slate-800/60 transition-all duration-500 group relative"
            >
                {isAdmin && (
                    <button 
                        onClick={(e) => { e.stopPropagation(); onDelete(program.id); }}
                        className="absolute top-3 right-3 z-10 p-2 bg-red-500/20 text-red-400 rounded-full opacity-0 group-hover:opacity-100 transition-opacity hover:bg-red-500 hover:text-white"
                    >
                        <i data-lucide="trash-2" style={{width: 14, height: 14}}></i>
                    </button>
                )}
                <div className="relative aspect-video overflow-hidden">
                    <img 
                        src={`https://img.youtube.com/vi/${program.youtubeId}/maxresdefault.jpg`} 
                        onError={(e) => e.target.src = `https://img.youtube.com/vi/${program.youtubeId}/hqdefault.jpg`}
                        alt={program.title} 
                        className="w-full h-full object-cover group-hover:scale-110 transition-transform duration-700" 
                    />
                    <div className="absolute inset-0 bg-gradient-to-t from-slate-950/80 via-transparent to-transparent opacity-60" />
                    <div className="absolute bottom-3 right-3 bg-slate-950/80 backdrop-blur-md border border-white/10 px-2 py-1 rounded-lg text-[10px] text-indigo-300 font-bold flex items-center gap-1">
                        ★ {program.avgScore ? program.avgScore.toFixed(1) : 'N/A'}
                    </div>
                </div>
                <div className="p-4">
                    <p className="text-[10px] text-slate-400 font-black uppercase tracking-[0.2em] mb-1">{program.creatorName}</p>
                    <h3 className="text-slate-100 text-[15px] font-bold line-clamp-2 leading-snug mb-3">{program.title}</h3>
                    <p className="text-slate-500 text-[11px] leading-relaxed line-clamp-1 border-l border-slate-700 pl-3 italic">{program.pitch}</p>
                </div>
            </div>
        );

        const App = () => {
            const [user, setUser] = React.useState(null);
            const [activeTab, setActiveTab] = React.useState('accueil');
            const [programs, setPrograms] = React.useState([]);
            const [selectedProgram, setSelectedProgram] = React.useState(null);
            const [showAdmin, setShowAdmin] = React.useState(false);

            // Redirection vers écran de config si nécessaire
            if (!isConfigured) {
                return (
                    <div className="min-h-screen flex items-center justify-center bg-slate-950 p-6 text-center">
                        <div className="max-w-md bg-slate-900 p-10 rounded-[2.5rem] border border-indigo-500/30 shadow-2xl">
                            <div className="w-16 h-16 bg-indigo-600 rounded-2xl flex items-center justify-center mx-auto mb-6">
                                <i data-lucide="settings" className="text-white"></i>
                            </div>
                            <h1 className="text-2xl font-black text-white mb-4">Configuration Requise</h1>
                            <p className="text-slate-400 text-sm mb-6 leading-relaxed">
                                Pour que Tube-Programme fonctionne, vous devez insérer vos clés Firebase dans le fichier <code>index.html</code> (ligne 37).
                            </p>
                            <a href="https://console.firebase.google.com" target="_blank" className="inline-block bg-indigo-600 text-white px-6 py-3 rounded-xl font-bold text-sm hover:bg-indigo-500 transition-all">
                                Ouvrir la console Firebase
                            </a>
                        </div>
                    </div>
                );
            }

            React.useEffect(() => {
                signInAnonymously(auth);
                onAuthStateChanged(auth, setUser);
                setTimeout(() => window.lucide.createIcons(), 100);
            }, []);

            React.useEffect(() => {
                if (!user) return;
                const q = collection(db, 'artifacts', appId, 'public', 'data', 'programs');
                const unsubscribe = onSnapshot(q, (snapshot) => {
                    const progs = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    setPrograms(progs);
                    setTimeout(() => window.lucide.createIcons(), 100);
                });
                return () => unsubscribe();
            }, [user]);

            const handleDelete = async (id) => {
                if (!confirm("Supprimer ce programme ?")) return;
                await deleteDoc(doc(db, 'artifacts', appId, 'public', 'data', 'programs', id));
            };

            const filteredPrograms = activeTab === 'accueil' 
                ? programs 
                : programs.filter(p => p.categoryId === activeTab);

            return (
                <div className="min-h-screen flex">
                    {/* Sidebar */}
                    <aside className="w-72 bg-slate-950/50 backdrop-blur-xl border-r border-slate-800/40 flex flex-col fixed h-full z-40">
                        <div className="p-10 flex items-center gap-2">
                            <div className="w-8 h-8 bg-indigo-600 rounded-lg flex items-center justify-center">
                                <i data-lucide="sparkles" className="text-white" style={{width: 18, height: 18}}></i>
                            </div>
                            <h1 className="text-lg font-black tracking-tight uppercase italic text-white">Tube<span className="text-indigo-500">Prog</span></h1>
                        </div>
                        <nav className="flex-1 px-4 space-y-1">
                            <button onClick={() => setActiveTab('accueil')} className={`w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all ${activeTab === 'accueil' ? 'bg-indigo-600/20 text-indigo-400 font-bold' : 'text-slate-400 hover:bg-slate-800/20'}`}>
                                <i data-lucide="layout-grid" style={{width: 18, height: 18}}></i> <span>La Grille</span>
                            </button>
                            <div className="mt-8 mb-4 px-4 text-[10px] font-black text-slate-600 uppercase tracking-widest">Thématiques</div>
                            {THEMES.map(t => (
                                <button key={t.id} onClick={() => setActiveTab(t.id)} className={`w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all ${activeTab === t.id ? 'bg-indigo-600/20 text-indigo-400 font-bold' : 'text-slate-400 hover:bg-slate-800/20'}`}>
                                    <i data-lucide={t.icon} style={{width: 16, height: 16}}></i> <span>{t.label}</span>
                                </button>
                            ))}
                        </nav>
                        <div className="p-8">
                            <button onClick={() => setShowAdmin(true)} className="w-full py-3 bg-slate-900 border border-slate-800 rounded-xl text-[10px] font-black uppercase tracking-widest text-slate-500 hover:text-indigo-400 transition-all">
                                Admin Curation
                            </button>
                        </div>
                    </aside>

                    {/* Main */}
                    <main className="ml-72 flex-1 pb-20">
                        <header className="p-10">
                            <h2 className="text-5xl font-black text-white tracking-tight mb-2 uppercase italic leading-none">
                                {activeTab === 'accueil' ? 'Cette semaine' : activeTab}
                            </h2>
                            <p className="text-slate-500 font-medium">La sélection des titulaires validés par la communauté.</p>
                        </header>

                        <div className="px-10">
                            {filteredPrograms.length > 0 ? (
                                <div className="flex gap-8 overflow-x-auto pb-10 no-scrollbar">
                                    {filteredPrograms.map(prog => (
                                        <ProgramCard key={prog.id} program={prog} onSelect={setSelectedProgram} isAdmin={true} onDelete={handleDelete} />
                                    ))}
                                </div>
                            ) : (
                                <div className="border-2 border-dashed border-slate-800 rounded-[3rem] p-24 text-center">
                                    <p className="text-slate-600 font-bold uppercase tracking-widest text-[10px] mb-4">La grille est vide.</p>
                                    <button onClick={() => setShowAdmin(true)} className="text-indigo-400 font-black text-xs uppercase tracking-widest hover:text-indigo-300 transition-colors underline decoration-2 underline-offset-4 italic">Ajouter la première pépite →</button>
                                </div>
                            )}
                        </div>
                    </main>

                    {/* Player Modal */}
                    {selectedProgram && (
                        <div className="fixed inset-0 z-[60] bg-slate-950/98 backdrop-blur-3xl flex items-center justify-center p-12">
                            <button onClick={() => setSelectedProgram(null)} className="absolute top-10 right-10 text-slate-500 border border-slate-800 px-6 py-2 rounded-full uppercase text-[10px] font-black tracking-widest hover:text-white transition-all">Fermer</button>
                            <div className="max-w-6xl w-full grid grid-cols-3 gap-16 items-center">
                                <div className="col-span-2 aspect-video bg-black rounded-[2.5rem] overflow-hidden shadow-2xl shadow-indigo-500/10 border border-white/5">
                                    <iframe width="100%" height="100%" src={`https://www.youtube.com/embed/${selectedProgram.youtubeId}?autoplay=1`} frameBorder="0" allowFullScreen></iframe>
                                </div>
                                <div className="col-span-1 py-4">
                                    <span className="text-indigo-400 font-black text-[10px] uppercase tracking-widest bg-indigo-500/10 px-3 py-1 rounded-full">{selectedProgram.creatorName}</span>
                                    <h3 className="text-4xl font-black text-white mt-6 mb-8 leading-tight">{selectedProgram.title}</h3>
                                    <p className="text-slate-400 italic leading-relaxed text-lg border-l-2 border-indigo-500/50 pl-6 italic">"{selectedProgram.pitch}"</p>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Admin Modal (Simple Version for Demo) */}
                    {showAdmin && (
                        <div className="fixed inset-0 z-[70] bg-slate-950/90 backdrop-blur-md flex items-center justify-center p-6">
                            <div className="bg-slate-900 border border-slate-800 w-full max-w-lg rounded-[2.5rem] p-10 shadow-2xl">
                                <div className="flex justify-between items-center mb-8">
                                    <h2 className="text-2xl font-black text-white uppercase italic">Curation Admin</h2>
                                    <button onClick={() => setShowAdmin(false)} className="text-slate-500 hover:text-white"><i data-lucide="x"></i></button>
                                </div>
                                <p className="text-slate-400 text-sm mb-6">Utilisez la console Firebase ou créez un formulaire pour ajouter des documents à la collection <code>programs</code>.</p>
                                <button onClick={() => setShowAdmin(false)} className="w-full py-4 bg-indigo-600 text-white font-black rounded-2xl uppercase tracking-widest">Compris</button>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
